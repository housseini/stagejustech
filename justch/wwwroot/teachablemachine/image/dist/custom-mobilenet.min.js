/**
 * Minified by jsDelivr using Terser v5.13.1.
 * Original file: /npm/@teachablemachine/image@0.8.5/dist/custom-mobilenet.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __awaiter=this&&this.__awaiter||function(e,t,a,r){return new(a||(a=Promise))((function(o,n){function i(e){try{l(r.next(e))}catch(e){n(e)}}function s(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var a,r,o,n,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(a)throw new TypeError("Generator is already executing.");for(;i;)try{if(a=1,r&&(o=2&n[0]?r.return:n[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,n[1])).done)return o;switch(r=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return i.label++,{value:n[1],done:!1};case 5:i.label++,r=n[1],n=[0];continue;case 7:n=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==n[0]&&2!==n[0])){i=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){i.label=n[1];break}if(6===n[0]&&i.label<o[1]){i.label=o[1],o=n;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(n);break}o[2]&&i.ops.pop(),i.trys.pop();continue}n=t.call(e,i)}catch(e){n=[6,e],r=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.loadFromFiles=exports.load=exports.loadTruncatedMobileNet=exports.CustomMobileNet=exports.getTopKClasses=exports.IMAGE_SIZE=void 0;var tf=require("@tensorflow/tfjs"),tfjs_1=require("@tensorflow/tfjs"),tf_1=require("./utils/tf"),canvas_1=require("./utils/canvas"),version_1=require("./version"),DEFAULT_MOBILENET_VERSION=1,DEFAULT_TRAINING_LAYER_V1="conv_pw_13_relu",DEFAULT_TRAINING_LAYER_V2="out_relu",DEFAULT_ALPHA_V1=.25,DEFAULT_ALPHA_V2=.35;exports.IMAGE_SIZE=224;var fillMetadata=function(e){return e.packageVersion=e.packageVersion||version_1.version,e.packageName=e.packageName||"@teachablemachine/image",e.timeStamp=e.timeStamp||(new Date).toISOString(),e.userMetadata=e.userMetadata||{},e.modelName=e.modelName||"untitled",e.labels=e.labels||[],e.imageSize=e.imageSize||exports.IMAGE_SIZE,e},isMetadata=function(e){return!!e&&Array.isArray(e.labels)},isAlphaValid=function(e,t){if(1===e){if(.25!==t&&.5!==t&&.75!==t&&1!==t)return console.warn("Invalid alpha. Options are: 0.25, 0.50, 0.75 or 1.00."),console.log("Loading model with alpha: ",DEFAULT_ALPHA_V1.toFixed(2)),DEFAULT_ALPHA_V1}else if(.35!==t&&.5!==t&&.75!==t&&1!==t)return console.warn("Invalid alpha. Options are: 0.35, 0.50, 0.75 or 1.00."),console.log("Loading model with alpha: ",DEFAULT_ALPHA_V2.toFixed(2)),DEFAULT_ALPHA_V2;return t},parseModelOptions=function(e){if((e=e||{}).checkpointUrl&&e.trainingLayer)return(e.alpha||e.version)&&console.warn("Checkpoint URL passed to modelOptions, alpha options are ignored"),[e.checkpointUrl,e.trainingLayer];if(e.version=e.version||DEFAULT_MOBILENET_VERSION,1===e.version){e.alpha=e.alpha||DEFAULT_ALPHA_V1,e.alpha=isAlphaValid(e.version,e.alpha),console.log("Loading mobilenet "+e.version+" and alpha "+e.alpha);var t=e.alpha.toFixed(2);return"1.00"===t&&(t="1.0"),["https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_"+t+"_"+exports.IMAGE_SIZE+"/model.json",DEFAULT_TRAINING_LAYER_V1]}if(2===e.version)return e.alpha=e.alpha||DEFAULT_ALPHA_V2,e.alpha=isAlphaValid(e.version,e.alpha),console.log("Loading mobilenet "+e.version+" and alpha "+e.alpha),["https://storage.googleapis.com/teachable-machine-models/mobilenet_v2_weights_tf_dim_ordering_tf_kernels_"+e.alpha.toFixed(2)+"_"+exports.IMAGE_SIZE+"_no_top/model.json",DEFAULT_TRAINING_LAYER_V2];throw new Error("MobileNet V"+e.version+" doesn't exist")},processMetadata=function(e){return __awaiter(void 0,void 0,void 0,(function(){var t;return __generator(this,(function(a){switch(a.label){case 0:return"string"!=typeof e?[3,3]:[4,fetch(e)];case 1:return[4,a.sent().json()];case 2:return t=a.sent(),[3,4];case 3:if(!isMetadata(e))throw new Error("Invalid Metadata provided");t=e,a.label=4;case 4:return[2,fillMetadata(t)]}}))}))};function getTopKClasses(e,t,a){return void 0===a&&(a=3),__awaiter(this,void 0,void 0,(function(){var r;return __generator(this,(function(o){switch(o.label){case 0:return[4,t.data()];case 1:return r=o.sent(),[2,tf.tidy((function(){a=Math.min(a,r.length);for(var t=[],o=0;o<r.length;o++)t.push({value:r[o],index:o});t.sort((function(e,t){return t.value-e.value}));var n=new Float32Array(a),i=new Int32Array(a);for(o=0;o<a;o++)n[o]=t[o].value,i[o]=t[o].index;var s=[];for(o=0;o<i.length;o++)s.push({className:e[i[o]],probability:n[o]});return s}))]}}))}))}exports.getTopKClasses=getTopKClasses;var CustomMobileNet=function(){function e(e,t){this.model=e,this._metadata=fillMetadata(t)}return Object.defineProperty(e,"EXPECTED_IMAGE_SIZE",{get:function(){return exports.IMAGE_SIZE},enumerable:!1,configurable:!0}),e.prototype.getMetadata=function(){return this._metadata},e.prototype.getTotalClasses=function(){return this.model.output.shape[1]},e.prototype.getClassLabels=function(){return this._metadata.labels},e.prototype.predictTopK=function(e,t,a){return void 0===t&&(t=10),void 0===a&&(a=!1),__awaiter(this,void 0,void 0,(function(){var r,o,n,i=this;return __generator(this,(function(s){switch(s.label){case 0:return r=canvas_1.cropTo(e,this._metadata.imageSize,a),o=tf.tidy((function(){var e=tf_1.capture(r,i._metadata.grayscale);return i.model.predict(e)})),[4,getTopKClasses(this._metadata.labels,o,t)];case 1:return n=s.sent(),tfjs_1.dispose(o),[2,n]}}))}))},e.prototype.predict=function(e,t){return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,(function(){var a,r,o,n,i,s=this;return __generator(this,(function(l){switch(l.label){case 0:return a=canvas_1.cropTo(e,this._metadata.imageSize,t),[4,(r=tf.tidy((function(){var e=tf_1.capture(a,s._metadata.grayscale);return s.model.predict(e)}))).data()];case 1:for(o=l.sent(),n=[],i=0;i<o.length;i++)n.push({className:this._metadata.labels[i],probability:o[i]});return tfjs_1.dispose(r),[2,n]}}))}))},e.prototype.dispose=function(){this.truncatedModel.dispose()},e}();function loadTruncatedMobileNet(e){return __awaiter(this,void 0,void 0,(function(){var t,a,r,o,n,i,s;return __generator(this,(function(l){switch(l.label){case 0:return t=parseModelOptions(e),a=t[0],r=t[1],[4,tf.loadLayersModel(a)];case 1:return o=l.sent(),e&&1===e.version?(n=o.getLayer(r),i=tf.model({inputs:o.inputs,outputs:n.output}),(s=tf.sequential()).add(i),s.add(tf.layers.flatten()),[2,s]):(n=o.getLayer(r),i=tf.model({inputs:o.inputs,outputs:n.output}),(s=tf.sequential()).add(i),s.add(tf.layers.globalAveragePooling2d({})),[2,s])}}))}))}function load(e,t){return __awaiter(this,void 0,void 0,(function(){var a,r;return __generator(this,(function(o){switch(o.label){case 0:return[4,tf.loadLayersModel(e)];case 1:return a=o.sent(),t?[4,processMetadata(t)]:[3,3];case 2:return r=o.sent(),[3,4];case 3:r=null,o.label=4;case 4:return[2,new CustomMobileNet(a,r)]}}))}))}function loadFromFiles(e,t,a){return __awaiter(this,void 0,void 0,(function(){var r,o,n;return __generator(this,(function(i){switch(i.label){case 0:return[4,tf.loadLayersModel(tf.io.browserFiles([e,t]))];case 1:return r=i.sent(),[4,new Response(a).json()];case 2:return o=i.sent(),a?[4,processMetadata(o)]:[3,4];case 3:return n=i.sent(),[3,5];case 4:n=null,i.label=5;case 5:return[2,new CustomMobileNet(r,n)]}}))}))}exports.CustomMobileNet=CustomMobileNet,exports.loadTruncatedMobileNet=loadTruncatedMobileNet,exports.load=load,exports.loadFromFiles=loadFromFiles;
//# sourceMappingURL=/sm/0fc088dc97b8856b242a4a96744c79262ce231846aa6e9cfe5c0f4c3927c4692.map